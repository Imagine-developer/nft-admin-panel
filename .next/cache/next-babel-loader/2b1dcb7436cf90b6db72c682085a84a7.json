{"ast":null,"code":"var _jsxFileName = \"/Users/andreyplatonov/Downloads/Telegram Desktop/wieldy-v-2.4.3/next-js-jwt-stater-kit/util/use-auth.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useContext, createContext } from \"react\";\nimport { httpClient } from \"./Api\";\nimport { Cookies } from \"react-cookie\";\nvar authContext = /*#__PURE__*/createContext(); // Provider component that wraps app and makes auth object ..\n// ... available to any child component that calls useAuth().\n\nexport function AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n  var auth = useProvideAuth();\n  return __jsx(authContext.Provider, {\n    value: auth,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 12,\n      columnNumber: 10\n    }\n  }, children);\n} // Hook for child components to get the auth object ...\n// ... and re-render when it changes.\n\n_s(AuthProvider, \"XNU4Jn8u4aVzJknlKOHFJq03xMo=\", false, function () {\n  return [useProvideAuth];\n});\n\n_c = AuthProvider;\nexport var useAuth = function useAuth() {\n  _s2();\n\n  return useContext(authContext);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar useProvideAuth = function useProvideAuth() {\n  _s3();\n\n  var _useState = useState(null),\n      authUser = _useState[0],\n      setAuthUser = _useState[1];\n\n  var _useState2 = useState(true),\n      loadingAuthUser = _useState2[0],\n      setLoadingAuthUser = _useState2[1];\n\n  var _useState3 = useState(false),\n      isLoading = _useState3[0],\n      setLoading = _useState3[1];\n\n  var _useState4 = useState(''),\n      error = _useState4[0],\n      setError = _useState4[1];\n\n  var fetchStart = function fetchStart() {\n    setLoading(true);\n    setError('');\n  };\n\n  var fetchSuccess = function fetchSuccess() {\n    setLoading(false);\n    setError('');\n  };\n\n  var fetchError = function fetchError(error) {\n    setLoading(false);\n    setError(error);\n  };\n\n  var userLogin = function userLogin(data, callbackFun) {\n    fetchStart();\n    httpClient.post('admin/login', data).then(function (_ref2) {\n      var data = _ref2.data;\n\n      if (data.result) {\n        fetchSuccess();\n        httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + data.token.access_token;\n        var cookies = new Cookies();\n        cookies.set('token', data.token.access_token);\n        getAuthUser();\n        if (callbackFun) callbackFun();\n      } else {\n        fetchError(data.error);\n      }\n    })[\"catch\"](function (error) {\n      fetchError(error.message);\n    });\n  };\n\n  var userSignup = function userSignup(data, callbackFun) {\n    fetchStart();\n    httpClient.post('auth/register', data).then(function (_ref3) {\n      var data = _ref3.data;\n\n      if (data.result) {\n        fetchSuccess();\n        httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + data.token.access_token;\n        var cookies = new Cookies();\n        cookies.set('token', data.token.access_token);\n        if (callbackFun) callbackFun();\n      } else {\n        fetchError(data.error);\n      }\n    })[\"catch\"](function (error) {\n      fetchError(error.message);\n    });\n  };\n\n  var userSignOut = function userSignOut(callbackFun) {\n    fetchStart();\n    fetchSuccess();\n    setAuthUser(false);\n    httpClient.defaults.headers.common['Authorization'] = '';\n    var cookies = new Cookies();\n    cookies.remove('token');\n  };\n\n  var getAuthUser = function getAuthUser() {\n    fetchStart();\n    httpClient.post(\"auth/me\").then(function (_ref4) {\n      var data = _ref4.data;\n\n      if (data.user) {\n        fetchSuccess();\n        setAuthUser(data.user);\n      } else {\n        fetchError(data.error);\n      }\n    })[\"catch\"](function (error) {\n      httpClient.defaults.headers.common['Authorization'] = '';\n      fetchError(error.message);\n    });\n  }; // Subscribe to user on mount\n  // Because this sets state in the callback it will cause any ...\n  // ... component that utilizes this hook to re-render with the ...\n  // ... latest auth object.\n\n\n  useEffect(function () {\n    var cookies = new Cookies();\n    var token = cookies.get(\"token\");\n    httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + token;\n    httpClient.post(\"auth/me\").then(function (_ref5) {\n      var data = _ref5.data;\n\n      if (data.user) {\n        setAuthUser(data.user);\n      }\n\n      setLoadingAuthUser(false);\n    })[\"catch\"](function (error) {\n      cookies.remove('token');\n      httpClient.defaults.headers.common['Authorization'] = '';\n      setLoadingAuthUser(false);\n    });\n  }, []); // Return the user object and auth methods\n\n  return {\n    loadingAuthUser: loadingAuthUser,\n    isLoading: isLoading,\n    authUser: authUser,\n    error: error,\n    setAuthUser: setAuthUser,\n    getAuthUser: getAuthUser,\n    userLogin: userLogin,\n    userSignup: userSignup,\n    userSignOut: userSignOut\n  };\n};\n\n_s3(useProvideAuth, \"5it/GFBnuEqcklxgiSG1f2VqaH4=\");\n\nexport var isUnRestrictedRoute = function isUnRestrictedRoute(pathname) {\n  return pathname === '/signin' || pathname === '/signup' || pathname === '/forgot-password' || pathname === '/reset-password';\n};\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/Users/andreyplatonov/Downloads/Telegram Desktop/wieldy-v-2.4.3/next-js-jwt-stater-kit/util/use-auth.js"],"names":["React","useState","useEffect","useContext","createContext","httpClient","Cookies","authContext","AuthProvider","children","auth","useProvideAuth","useAuth","authUser","setAuthUser","loadingAuthUser","setLoadingAuthUser","isLoading","setLoading","error","setError","fetchStart","fetchSuccess","fetchError","userLogin","data","callbackFun","post","then","result","defaults","headers","common","token","access_token","cookies","set","getAuthUser","message","userSignup","userSignOut","remove","user","get","isUnRestrictedRoute","pathname"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useContext, createContext} from \"react\";\r\nimport {httpClient} from \"./Api\";\r\nimport {Cookies} from \"react-cookie\";\r\n\r\nconst authContext = createContext();\r\n\r\n// Provider component that wraps app and makes auth object ..\r\n// ... available to any child component that calls useAuth().\r\n\r\nexport function AuthProvider({children}) {\r\n  const auth = useProvideAuth();\r\n  return <authContext.Provider value={auth}>{children}</authContext.Provider>;\r\n}\r\n\r\n// Hook for child components to get the auth object ...\r\n// ... and re-render when it changes.\r\n\r\nexport const useAuth = () => {\r\n  return useContext(authContext);\r\n};\r\n\r\nconst useProvideAuth = () => {\r\n  const [authUser, setAuthUser] = useState(null);\r\n  const [loadingAuthUser, setLoadingAuthUser] = useState(true);\r\n  const [isLoading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const fetchStart = () => {\r\n    setLoading(true);\r\n    setError('');\r\n  }\r\n\r\n  const fetchSuccess = () => {\r\n    setLoading(false);\r\n    setError('');\r\n  }\r\n\r\n  const fetchError = (error) => {\r\n    setLoading(false);\r\n    setError(error);\r\n  }\r\n\r\n  const userLogin = (data, callbackFun) => {\r\n    fetchStart();\r\n    httpClient.post('admin/login', data)\r\n      .then(({data}) => {\r\n        if (data.result) {\r\n          fetchSuccess();\r\n          httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + data.token.access_token;\r\n          const cookies = new Cookies();\r\n          cookies.set('token', data.token.access_token);\r\n          getAuthUser();\r\n          if (callbackFun) callbackFun();\r\n        } else {\r\n          fetchError(data.error);\r\n        }\r\n      })\r\n      .catch(function (error) {\r\n        fetchError(error.message);\r\n      });\r\n  };\r\n\r\n  const userSignup = (data, callbackFun) => {\r\n    fetchStart();\r\n    httpClient.post('auth/register', data)\r\n      .then(({data}) => {\r\n        if (data.result) {\r\n          fetchSuccess();\r\n          httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + data.token.access_token;\r\n          const cookies = new Cookies();\r\n          cookies.set('token', data.token.access_token);\r\n          if (callbackFun) callbackFun();\r\n        } else {\r\n          fetchError(data.error);\r\n        }\r\n      })\r\n      .catch(function (error) {\r\n        fetchError(error.message);\r\n      });\r\n  };\r\n\r\n  const userSignOut = (callbackFun) => {\r\n    fetchStart();\r\n          fetchSuccess();\r\n          setAuthUser(false);\r\n          httpClient.defaults.headers.common['Authorization'] = '';\r\n          const cookies = new Cookies();\r\n          cookies.remove('token');\r\n  };\r\n\r\n  const getAuthUser = () => {\r\n    fetchStart();\r\n    httpClient.post(\"auth/me\").then(({data}) => {\r\n      if (data.user) {\r\n        fetchSuccess();\r\n        setAuthUser(data.user);\r\n      } else {\r\n        fetchError(data.error);\r\n      }\r\n    }).catch(function (error) {\r\n      httpClient.defaults.headers.common['Authorization'] = '';\r\n      fetchError(error.message);\r\n    });\r\n  }\r\n\r\n  // Subscribe to user on mount\r\n  // Because this sets state in the callback it will cause any ...\r\n  // ... component that utilizes this hook to re-render with the ...\r\n  // ... latest auth object.\r\n\r\n  useEffect(() => {\r\n      const cookies = new Cookies();\r\n      const token = cookies.get(\"token\");\r\n      httpClient.defaults.headers.common['Authorization'] = 'Bearer ' + token;\r\n\r\n      httpClient.post(\"auth/me\").then(({data}) => {\r\n        if (data.user) {\r\n          setAuthUser(data.user);\r\n        }\r\n        setLoadingAuthUser(false);\r\n      }).catch(function (error) {\r\n        cookies.remove('token');\r\n        httpClient.defaults.headers.common['Authorization'] = '';\r\n        setLoadingAuthUser(false);\r\n      });\r\n    }, []\r\n  );\r\n\r\n  // Return the user object and auth methods\r\n  return {\r\n    loadingAuthUser,\r\n    isLoading,\r\n    authUser,\r\n    error,\r\n    setAuthUser,\r\n    getAuthUser,\r\n    userLogin,\r\n    userSignup,\r\n    userSignOut,\r\n  };\r\n}\r\n\r\nexport const isUnRestrictedRoute = (pathname) => {\r\n  return pathname === '/signin' || pathname === '/signup' || pathname === '/forgot-password' || pathname === '/reset-password';\r\n}\r\n"]},"metadata":{},"sourceType":"module"}